var CONFIG=RLCONF.Parsifal;const REG_START=new RegExp(CONFIG.TAGS.map((e=>"^<"+e)).join("|")),REG_END=new RegExp(CONFIG.TAGS.map((e=>"</"+e+">")).join("|")),REG_ANY=REG_END;let params=new URL(document.location).searchParams,name=params.get("specode");if("side"==name){var head=document.getElementsByTagName("head")[0];(s=document.createElement("style")).setAttribute("type","text/css"),s.appendChild(document.createTextNode("#content, #footer, #mw-head {display:none;}")),head.appendChild(s)}else if("main"==name){var s;head=document.getElementsByTagName("head")[0];(s=document.createElement("style")).setAttribute("type","text/css"),s.appendChild(document.createTextNode("#mw-panel {display:none;}  .mw-body {margin-left:0em;}")),head.appendChild(s)}const PARSIFAL=window.PARSIFAL={pageContainsTex:()=>{const e=document.getElementById("wpTextbox1");return e?!!REG_ANY.test(e.value)||(console.log("Parsifal: Found nothing to tex in page ",REG_ANY),!1):(console.warn("Parsifal:helper.js: found no editbox in pageContainsTex - should not happen at this stage"),!1)},editPreviewPatch:()=>{(()=>{console.info("------------------ initializeTextarea");var e=document.getElementById("wpTextbox1");const t=()=>{return;console.log("received a resize event"),document.getElementById("textarea-wrapper"),shouldReset=!0,console.log("preview.js: resize observer storing textarea dimensions "),window.localStorage.setItem("textareaWidth",Math.max(100,e.offsetWidth)),window.localStorage.setItem("textareaHeight",Math.max(100,e.offsetHeight)),waitBeforeInvoke(300)};new ResizeObserver(t).observe(e),new ResizeObserver(t).observe(document.body),Object.assign(e.style,{minWidth:"150px",resize:"both",display:"inline-block"}),window.localStorage.getItem("textareaWidth")&&(e.style.width=window.localStorage.getItem("textareaWidth")+"px"),window.localStorage.getItem("textareaHeight")&&(e.style.height=window.localStorage.getItem("textareaHeight")+"px"),e.myFontSize=14,e.style.fontSize=e.myFontSize+"pt",e.addEventListener("keydown",(t=>{!t.metaKey||"+"!=t.key&&"-"!=t.key||(t.preventDefault(),t.stopPropagation(),e.myFontSize+="+"==t.key?2:-2,e.style.fontSize=e.myFontSize+"pt")}));var n=document.createElement("div");n.id="new-edit-container",Object.assign(n.style,{display:"flex"}),e.parentNode.replaceChild(n,e),n.appendChild(e);var o=document.createElement("div");o.id="inline-edit-preview-container",Object.assign(o.style,{minWidth:"18px",border:"1px solid red",display:"inline-block",flex:"1 1 auto","box-sizing":"border-box",position:"relative"});var i=document.createElement("img");i.id="previewImage",Object.assign(i.style,{width:"100%",height:"100%",position:"absolute",border:"0px solid yellow",left:"0px",top:"0px"});var r=document.createElement("iframe");r.id="previewFrame",Object.assign(r.style,{width:"100%",height:"100%",position:"absolute",left:"0px",top:"0px"}),i.style.visibility=r.style.visibility="hidden",o.appendChild(i),o.appendChild(r),n.appendChild(o),document.getElementById("editform").addEventListener("input",processEdit),window.setTimeout((()=>{processEdit("INIT")}),0)})(),"codemirror"==new URL(document.location).searchParams.get("editormode")&&initializeCodeMirror()}};function toggleNext(e){const t=e.target,n=e.target.nextSibling;$(n).slideToggle(150),t.classList.toggle("collapseButtonToggled"),e.shiftKey||($(".collapseResult").not(n).hide(),$(".collapseButtonToggled").not(t).removeClass("collapseButtonToggled"))}function toggleImg(e){const t=e.currentTarget,n=e.currentTarget.previousSibling;console.log("button: ",n),console.log("element: ",t),$(t).slideToggle(150),n.classList.toggle("collapseButtonToggled")}function adjust(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("style");n.setAttribute("type","text/css"),n.appendChild(document.createTextNode("div#mw-panel {width:15em;}  #left-navigation, #footer, #content {margin-left:15em;}")),t.appendChild(n)}function initializeCodeMirror(){var e=document.getElementById("wpTextbox1"),t=(CodeMirror.fromTextArea(e,{lineNumbers:!0,matchBrackets:!0}),document.querySelector(".CodeMirror"));t.myFontSize=14,t.style.fontSize=t.myFontSize+"pt",t.CodeMirror.refresh(),t.addEventListener("keydown",(e=>{!e.metaKey||"+"!=e.key&&"-"!=e.key||(e.preventDefault(),e.stopPropagation(),t.myFontSize+="+"==e.key?2:-2,t.style.fontSize=t.myFontSize+"pt",t.CodeMirror.refresh())}));const n=()=>{var e=t,n=document.getElementById("inline-edit-preview-container");n.style.height=e.clientHeight-2+"px",shouldReset=!0,waitBeforeInvoke(300),1==status&&(previewContainer.style.height=newEditContainer.clientHeight-wrapper.clientHeight+"px")};new ResizeObserver(n).observe(t),new ResizeObserver(n).observe(document.body)}const installDropZone=(e=document.documentElement,t)=>{var n=document.body;e.addEventListener("dragenter",(e=>{n.classList.add("dropzone-active")})),e.addEventListener("dragleave",(e=>{n.classList.remove("dropzone-active")})),e.addEventListener("dragover",(e=>{n.classList.add("dropzone-active"),e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"})),e.addEventListener("drop",(function(e){n.classList.remove("dropzone-active"),e.stopPropagation(),e.preventDefault();var o=e.dataTransfer.files;console.log("dropzone received ",o.length," files");let i=[];for(var r,s=0;r=o[s];s++)if(console.log("dropzone sees file: ",r),i.push(r.name),"application/pdf"==r.type){console.log("reading file");var a=new FileReader;a.onload=function(e){t&&(console.log("handling file"),t(e.target.result))},a.readAsArrayBuffer(r)}else alert("Cannot deal with a file of type: "+r.type)}))};async function dropHandler(e){openEmbedded(e),promiseSha1(e)}const promiseSha1=e=>(console.log(typeof e),crypto.subtle.digest("SHA-1",e).then((e=>{const t=[],n=new DataView(e);for(let e=0;e<n.byteLength;e+=1)t.push(n.getUint8(e).toString(16));return t.join("")})));var DATA;const DOCU_WINDOW_URL=document.location.protocol+"//"+document.location.host+"/wiki4/extensions/Parsifal/html/embedPresent.html";function openEmbedded(e){var t=window.open(DOCU_WINDOW_URL+"?"+Math.random(),"fresh","width=600,height=600");t.onload=n=>{t.postMessage({buf:e},DOCU_WINDOW_URL)}}window.sendToWiki=e=>{uploadToWiki(e,"application/pdf")};const MIME2EXT={"application/pdf":"pdf"};async function uploadToWiki(e,t,n){n||(n=await promiseSha1(e)),n+="."+MIME2EXT[t],console.log("will now upload "+n);var o={filename:n,format:"json"},i=$("<input/>").attr("type","file").value=new Blob([e],{type:t});(new mw.Api).upload(i,o).done((function(e){alert("uploaded"),console.log(e.upload.filename+" has sucessfully uploaded.")})).fail((function(e){alert("upload error: "+e),console.log("api reports: ",e)}))}function heightAdjust(){console.error("#######################################heightadjust");var e=document.getElementById("wpTextbox1"),t=document.getElementById("inline-edit-preview-container"),n=t.parentNode,o=e.clientHeight,i=t.clientHeight;e.addEventListener("mouseup",(e=>{var r=e.target.clientHeight,s=r-o;console.error("##heightadjust: textarea resized from initially "+o+" to now "+r+" difference is "+s),console.error("## heightadjust target for container",i-s+"px"),t.style.height=i-s+"px",n.style.height=i-s+"px"}))}var nextNumberIssuing=0,xhrReg={};function receivedEndpointResponse(e){var t=e.target,n=t.img;if(ERROR.clearError(),console.log(`received an endpointResponse, it is for request=${t.number}, img is showing=${t.img.showing}, pending are ${t.img.pending.length} requests: ${n.pending.map((e=>e.number)).join()}`),t.img.pending.forEach((e=>{console.log(`  request=${e.number} with readyState= ${e.readyState}`)})),n.pending=n.pending.filter((e=>!(e.number<t.number)||(console.log(`receivedEndpointResponse: ABORTING as outdated the pending request ${e.number}`),e.abort(),!1))),t.number<n.showing)console.log(`receivedEndpointResponse: DISCARDING an old result. We received ${t.number}. We show currently ${n.showing}`);else{var o=t.getResponseHeader("X-Latex-Hash"),i=t.getResponseHeader("Content-Type"),r=t.getResponseHeader("Content-Length"),s=t.getResponseHeader("X-Parsifal-Error"),a=t.getResponseHeader("X-Parsifal-ErrorDetails");if(1){var l=t.getResponseHeader("X-Parsifal-Width-Latex-Cm-Was"),d=t.getResponseHeader("X-Parsifal-Available-Pixel_Width-Was"),c=t.getResponseHeader("X-Parsifal-Dpi-Used"),u=t.getResponseHeader("X-Parsifal-Gamma-Used");console.info(`receivedEndpointResponse: of type=${t.response.type} size=${t.response.size} length=${r} hash=${o}`),console.log(`receivedEndpointResponse from ${t.responseURL} with headers: hash=${o}, type=${i}, len=${r}, readyState=${t.readyState}, status=${t.status} and target.response=`,t.response),console.log(`  additional headers received for check: widthLatexCmWas=${l} availablePixelWidthWas=${d} dpiUsed=${c} gammaUsed=${u}`)}if(showLogLinks(o),"Hard"==s)return console.error("receivedEndpointResponse: received X-Parsifal-Error = Hard. NO result to display. Will display error message instead"),void t.response.text().then((e=>{200!=t.status&&(e="Server responded: "+t.status+" "+t.statusText+"\n"+e),console.error("   error message received is: "+e),ERROR.showError(e,s),n.showing=t.number,n.pending=n.pending.filter((e=>e.number!=t.number)),console.log(`  have just completed serving request ${t.number}; now still ${n.pending.length} remaining on queue: ${n.pending.map((e=>e.number)).join()} `)}));"Soft"==s&&(a||(a="Soft error. Will probably vanish when completing Latex command"),ERROR.showError(a,"Soft")),i.startsWith("image")?(console.log("Client received IMAGE data from endpoint"),t.img.src=window.URL.createObjectURL(t.response),t.img.onload=function(){window.URL.revokeObjectURL(this.src),n.showing=t.number,n.pending=n.pending.filter((e=>e.number!=t.number)),console.log(`  have just completed serving request ${t.number}; now still ${n.pending.length} remaining on queue: ${n.pending.map((e=>e.number)).join()} `),n.setAttribute("data-image-width-requested-from-server",d),n.setAttribute("data-image-width-measured",t.img.width),n.setAttribute("data-image-natural-width-measured",t.img.naturalWidth)}):i.startsWith("text")?console.log("Client received TEXT data from endpoint"):console.error("faulting-in handle received an illegal type "+i+" for hash="+o),console.log(`at the end of the response handler for request=${t.number}, img is showing=${t.img.showing} and pending are still ${t.img.pending.length} requests: ${n.pending.map((e=>e.number)).join()}`),t.img.pending.forEach((e=>{console.log(`  request=${e.number} with readyState= ${e.readyState}`)}))}}window.showImage=function(e,t){e.style.display="inline-block"};const injectAnnotation=(e,t)=>{var n=document.getElementById("ANCH-"+t);if(n){var o=document.createElement("div");o.className="annoLayer",o.innerHTML=e,n.appendChild(o)}else console.error("Parsifal:helper.js: could not inject annotation since container element was not found")};function b64EncodeUnicode(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))}function Task(e){console.log("Parsifal:helper.js: Task called"),Task.running?(console.log("Parsifal:helper.js: there is a task which is still running"),Task.running.hasContinuation?console.log("Parsifal:helper.js: and this task already has a continuation set"):(console.log("Parsifal:helper.js: and this task has no continuation set, so we shall do this now"),Task.running.then((()=>{Task.running=null,console.log("Parsifal:helper.js: running a tasks continuation handler to check for a next task"),Task.nextOne&&(Task.nextOne(),Task.nextOne=null)})),Task.running.hasContinuation=!0),Task.nextOne=e):(console.log("Parsifal:helper.js:Task: no task runnin, running fct now"),Task.running=e())}function processEdit(e){console.info("***-----------------------** processEdit was invoked, tag = ",e),processEditDoNG()}window.checkForError=function(e){var t=new XMLHttpRequest;t.open("GET","/wiki4/extensions/Parsifal/tmp/"+e+".mrk",!0),t.send(),t.onload=t=>{var n=document.getElementById(e);n&&n.classList.add(t.total>0?"latex-error":"latex-ok"),(n=document.getElementById("inline-edit-preview-container"))&&(n.classList.remove("latex-error","latex-ok"),n.classList.add(t.total>0?"latex-error":"latex-ok"))}},Task.running=null,Task.nextOne=null;var timer=null;function waitBeforeInvoke(e){window.clearTimeout(timer),timer=window.setTimeout(processEdit,e)}const getCursor=e=>e.value.substr(0,e.selectionStart).split("\n").length-1;function findChunks(e){const t=/=+[a-zA-Z0-9()\s\/]+=+/,n=document.getElementById("wpTextbox1");var o=[],i=e.substr(0,n.selectionStart).split("\n"),r=i.length,s=i[i.length-1].length;i=e.split("\n");var a,l,d=0,c=null,u="";for(var h=0;h<i.length;h++)(a=i[h].match(REG_START))?(c&&(o.push({start:d,end:l,chunk:u,tag:c}),d<=r&&r<=l&&(currentChunk=h),u="",d=h),c=a[0].substring(1),u=""):-1!=i[h].search(REG_END)?(l=h,o.push({start:d,end:l,chunk:u,tag:c}),d<=r&&r<=l&&(currentChunk=h),c=null,u="",d=h+1):t.test(i[h].trimEnd())?(null==c?(o.push({start:h,end:h,chunk:i[h],tag:"TEXT"}),u="",d=h+1,l=h+1):"TEXT"==c?(o.push({start:d,end:l,chunk:u,tag:c}),d<=r&&r<=l&&(currentChunk=h),o.push({start:h,end:h,chunk:i[h],tag:"TEXT"}),u="",d=h+1,l=h+1):(u+=i[h]+"\n",l=h),c=null):(null==c&&(c="TEXT"),l=h,u+=i[h]+"\n");"TEXT"==c&&(o.push({start:d,end:l,chunk:u,tag:c}),d<=r&&r<=l&&(currentChunk=h));var g={arr:o,currentLine:r,currentColumn:s,currentChunk:currentChunk};return g}function logChunks(e){console.error("*** *** ***"),console.error("LOGGING CHUNK STRUCTURE");for(var t=0;t<e.length;t++)console.log(`Entry ${t} is from start=${e[t].start} to end=${e[t].end} with ${e[t].chunk.length} characters and tag=${e[t].tag}\n\n${e[t].chunk}`)}function escapeHtml(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}var editform,editBox,WORKER,shouldReset=!1,uiChunks=[];function makeTextCarrierNode(e){var t;return 0==(e=e.replace(/^\x20*\n/gm,"")).trim().length?(t=document.createElement("span")).innerHTML="White Space":e.trim().startsWith("=")?(t=document.createElement("div")).innerHTML=escapeHtml(e):(t=document.createElement("pre")).innerHTML=escapeHtml(e),t}function processEditDoNG(e,t){const n=document.getElementById("wpTextbox1");if(n)if(PARSIFAL.pageContainsTex()){var o=!1,i=findChunks(n.value);if(console.log(`processEditDoNG entered: Have ${uiChunks.length} uiChunks, reparse found ${i.arr.length} chunks; shouldReset=${shouldReset}`),i.arr.length!=uiChunks.length)console.error(`PARSIFAL:helper.js: The number of chunks has changed from ${uiChunks.length} to ${i.arr.length}. We need a rebuild of the chunk structure.`),o=!0;else for(var r=0;r<i.arr.length;r++)if(i.arr[r].tag!=uiChunks[r].tag){console.error(`PARSIFAL:helper.js: chunk[${r}] has changed from ${uiChunks.arr[r].tag} to ${i.arr[r].tag}. We need a rebuild of the chunk structure.`),o=!0;break}var s=document.getElementById("inline-edit-preview-container");if(o||shouldReset){shouldReset=!1,console.log("Rebuilding the chunk structure now"),uiChunks.length>0&&(console.error("  Cleaning up old chunks -- STILL MISSING CODE "),s.innerHTML="",uiChunks=[]),console.log(`Parsifal.php:helper.js: rebuildng chunk structure. Found ${i.arr.length} chunks and will now be iterating over them`);for(r=0;r<i.arr.length;r++)if("TEXT"==i.arr[r].tag){var a=makeTextCarrierNode(i.arr[r].chunk),l=document.createElement("div");l.className="preview-text-portion",l.appendChild(a),uiChunks[r]={tag:"TEXT",textCarrierNode:a},s.appendChild(l)}else{let e=document.createElement("img");e.className="inline-edit-preview-img",uiChunks[r]={tag:i.arr[r].tag,img:e},s.appendChild(e)}console.log("Chunk structure has been rebuilt")}else console.log("The chunk structure has stayed as it was");console.log(`Parsifal: helper.js now filling in tasks for the ${uiChunks.length} uiChunks `);for(let e=0;e<uiChunks.length;e++)"TEXT"==i.arr[e].tag?(uiChunks[e].implementedText==i.arr[e].chunk||(uiChunks[e].todoText=i.arr[e].chunk,uiChunks[e].tag=i.arr[e].tag),uiChunks[e].todoText=i.arr[e].chunk,uiChunks[e].tag=i.arr[e].tag):uiChunks[e].implementedBody==i.arr[e].chunk||(uiChunks[e].todoBody=i.arr[e].chunk,uiChunks[e].tag=i.arr[e].tag);var d=0;for(let e=0;e<uiChunks.length&&(uiChunks[e].todoBody&&d++,!(d>=2));e++);console.log("helper.js: now implementing the todos which changed todos");for(let e=0;e<uiChunks.length;e++)if(uiChunks[e].todoBody){console.log(`uiChunk ${e} has a latex todoBody starting with: ${uiChunks[e].todoBody.substring(0,10)}`);var c=b64EncodeUnicode(uiChunks[e].todoBody);const n=new XMLHttpRequest;n.img=uiChunks[e].img,n.img.idx=e,void 0===n.img.pending&&(n.img.pending=[]),void 0===n.img.showing&&(n.img.showing=-1),n.img.pending.push(n),n.number=nextNumberIssuing,xhrReg[n.number]=n,nextNumberIssuing++,n.open("POST","extensions/Parsifal/endpoints/tex-preview.php",!0),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8");let o={},r=JSON.stringify(o);n.setRequestHeader("X-Parsifal-Para",r),n.setRequestHeader("X-Parsifal-Tag",uiChunks[e].tag);var u=document.getElementById("inline-edit-preview-container");const s=u.clientWidth-10;u.setAttribute("data-available-width",s),n.setRequestHeader("X-Parsifal-Available-Pixel-Width",s),n.send(c),console.time("server for chunk "+e+" request "+nextNumberIssuing),n.responseType="blob",n.onload=t=>{receivedEndpointResponse(t),uiChunks[e].implementedBody=uiChunks[e].todoBody,uiChunks[e].todoBody=void 0,console.timeEnd("server for chunk "+e+" request "+nextNumberIssuing)},n.img.onclick=e=>{synchPreviewToEditor(e.target.idx,i,uiChunks);var t=document.querySelector(".chunk-selected");t&&t.classList.remove("chunk-selected"),e.target.classList.add("chunk-selected")},n.timeout=12e3,n.ontimeout=()=>{console.error("The request for a preview timed out"),t&&t()}}else if(uiChunks[e].todoText){console.log(`uiChunk ${e} has a todoText= ${uiChunks[e].todoText}`);var h=makeTextCarrierNode(uiChunks[e].todoText);uiChunks[e].textCarrierNode.parentNode.replaceChild(h,uiChunks[e].textCarrierNode),uiChunks[e].textCarrierNode=h,uiChunks[e].implementedText=uiChunks[e].todoText,uiChunks[e].textCarrierNode.onclick=t=>{synchPreviewToEditor(e,i,uiChunks);var n=document.querySelector(".chunk-selected");n&&n.classList.remove("chunk-selected"),t.target.classList.add("chunk-selected")}}else console.log(`uiCchunk ${e} had neither todoBody nor todoText `);void 0===n.isInstrumented&&(n.addEventListener("mouseup",(e=>{synchEditorToPreview(i,uiChunks)})),n.addEventListener("keyup",(e=>{if(["ArrowDown","ArrowLeft","ArrowRight","ArrowUp"].includes(e.key)){var t=window.getSelection();if(t&&t.toString().length>0)return;synchEditorToPreview(i,uiChunks)}})),n.isInstrumented=!0)}else console.log("Parsifal: processEditDoNG returning, contains no relevant tag");else console.log("Parsifal: processEditDoNG returning, no editBox")}function synchEditorToPreview(e,t){var n,o=(n=editBox).value.substr(0,n.selectionStart).split("\n").length-1;console.log("Cursor position in editbox reported at line: ",o);for(var i=null,r=0;r<e.arr.length;r++)if(e.arr[r].start<=o&&o<=e.arr[r].end){i=r;break}var s=document.querySelector(".chunk-selected");s&&s.classList.remove("chunk-selected"),t[i].img&&(t[i].img.classList.add("chunk-selected"),t[i].img.scrollIntoView({behavior:"smooth",block:"nearest"})),t[i].textCarrierNode&&(t[i].textCarrierNode.classList.add("chunk-selected"),t[i].textCarrierNode.scrollIntoView({behavior:"smooth",block:"nearest"}))}function synchPreviewToEditor(e,t,n){var o=t.arr[e].start,i=t.arr[e].end;"TEXT"!=t.arr[e].tag&&(o++,i--);var r=editBox.value.split("\n",o).join().length;0!=r&&r++;var s=editBox.value.split("\n",i+1).join().length;editBox.focus(),editBox.setSelectionRange(r,s);var a=editBox.value.split("\n").length,l=editBox.scrollHeight/a;editBox.scrollTop=(o-4)*Math.floor(l)}function initialize(){console.error("initialize"),editform=document.getElementById("editform"),editBox=document.getElementById("wpTextbox1"),editform&&editBox&&(console.error("Parsifal:helper.js: Detected an edit context, patching the Mediawiki edit page"),editform.addEventListener("input",processEdit)),document.body.addEventListener("keydown",(e=>{e.shiftKey&&e.ctrlKey&&document.body.classList.toggle("shift-down")})),initializeToc(),installDropZone(document.documentElement,dropHandler)}const ERROR={showError:(e,t)=>{console.error("Parsifal:helper.js: showing Error:",e);var n=document.getElementById("error-panel");n||((n=document.createElement("div")).setAttribute("id","error-panel"),n.className="error-panel",document.body.appendChild(n));var o=document.createElement("pre");o.innerHTML=e,n.innerHTML="",n.appendChild(o)},clearError:()=>{var e=document.getElementById("error-panel");e&&e.parentNode.removeChild(e)}};function showLogLinks(e){var t=document.getElementById("log-links");t||((t=document.createElement("div")).setAttribute("id","log-links"),t.className="log-links",document.body.appendChild(t));const n=`${CONFIG.HTML_URL}texLog.html?${e}_pc_pdflatex`,o=window.screen.width-1e3;t.innerHTML=`<a href="${n}" \n    onclick="window.open('${n}', '_blank', 'location=yes,height=${window.screen.height},left=${o},width=1000,scrollbars=yes,status=yes');event.stopPropagation();event.preventDefault();"\n    target='_new'>Log of TeX run</a>`}function clearLogLinks(){var e=document.getElementById("log-links");e&&e.parentNode.removeChild(e)}window.linkHint=function(e){document.querySelectorAll(`[data-id="a${e}"]`).forEach((t=>{let n=document.getElementById(`img${e}`);t.addEventListener("mouseover",(e=>{console.log("mousein "+e.target.innerHTML),e.stopPropagation(),n.timer=window.setTimeout((()=>{console.log("timer"),n.style.display="block";var t=e.target.offsetTop;console.log("etop = "+t),e.clientY<document.body.clientHeight/2?Object.assign(n.style,{left:"6px",top:t+42+"px"}):Object.assign(n.style,{left:"6px",top:t-n.clientHeight-10+"px"}),n.classList.add("showing")}),300)})),t.addEventListener("mouseout",(e=>{console.log("mouseout "+e.target.innerHTML),n.style.display="none",n.classList.remove("showing"),window.clearTimeout(n.timer)}))}))};const show=e=>{null===helpDiv&&(helpDiv=document.createElement("div"),helpDiv.id="pdf-dualHelpSheet",document.body.appendChild(helpDiv)),helpDiv.style.height=window.innerHeight-50+"px",helpDiv.style.maxWidth=window.innerWidth/2+"px",helpDiv.style.display="block"},hide=()=>{helpDiv&&(helpDiv.parentNode.removeChild(helpDiv),helpDiv=null)};function initializeToc(){const e=()=>{document.getElementById("toc").classList.toggle("showtoc")};window.addEventListener("DOMContentLoaded",(t=>{var n=document.getElementById("toc");(()=>{const e=document.getElementById("toc");var t=parseInt(localStorage.getItem("tocWidth"));t&&(e.style.width=t+"px"),e.style.display="block"})(),new ResizeObserver((()=>{localStorage.setItem("tocWidth",parseInt(n.style.width))})).observe(n);var o=document.querySelector(".toctitle");o&&(o.addEventListener("click",e),o.setAttribute("title","Click to toggle visibility of table of contents"))}))}window.toggleMe=function(e){$(e.target.nextSibling).toggle()},window.copyToClip=e=>{var t=event.target.dataset.name;navigator.clipboard.writeText(t).then((e=>{console.log("clipboard written: "+t)}),(e=>{console.log("clipboard error"),console.log(e)}))},window.addEventListener("DOMContentLoaded",initialize);